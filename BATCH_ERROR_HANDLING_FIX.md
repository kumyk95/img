# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∑–∞–≤–∏—Å–∞–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –±–æ–ª—å—à–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, 9999) –∏–Ω–æ–≥–¥–∞ –ø—Ä–æ—Ü–µ—Å—Å "–∑–∞–≤–∏—Å–∞–µ—Ç" –Ω–∞ –æ–¥–Ω–æ–º –∏–∑ —ç—Ç–∞–ø–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "Inpainting" –æ—Å—Ç–∞–µ—Ç—Å—è –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ "processing"), –∞ —Å–ª–µ–¥—É—é—â–∏–µ —ç—Ç–∞–ø—ã –Ω–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è.

### –ü—Ä–∏—á–∏–Ω–∞

–ö–æ–≥–¥–∞ HTTP –∑–∞–ø—Ä–æ—Å –∫ backend –ø–∞–¥–∞–µ—Ç —Å –æ—à–∏–±–∫–æ–π (timeout, —Å–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞, –æ—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏), —Å—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞ **–ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª–∞** –≤–µ—Å—å batch –ø—Ä–æ—Ü–µ—Å—Å:

```typescript
// –°–¢–ê–†–ê–Ø –õ–û–ì–ò–ö–ê (–ü–õ–û–•–û)
error: (err: any) => {
    console.error(`Step ${stepId} failed`, err);
    step.status = 'pending';
    this._isRunning$.next(false);  // ‚ùå –û–°–¢–ê–ù–ê–í–õ–ò–í–ê–ï–¢ –í–°–Å!
}
```

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–ª–æ, —á—Ç–æ –µ—Å–ª–∏ –∏–∑ 10000 —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π —Ö–æ—Ç—è –±—ã –æ–¥–Ω–∞ —É–ø–∞–ª–∞ —Å –æ—à–∏–±–∫–æ–π, **–≤–µ—Å—å –ø—Ä–æ—Ü–µ—Å—Å –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª—Å—è**.

---

## –†–µ—à–µ–Ω–∏–µ

### 1. –î–æ–±–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ (Retry Logic)

–¢–µ–ø–µ—Ä—å –ø—Ä–∏ –æ—à–∏–±–∫–µ —Å–∏—Å—Ç–µ–º–∞ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç** –∑–∞–ø—Ä–æ—Å –¥–æ 3 —Ä–∞–∑:

```typescript
// –ù–û–í–ê–Ø –õ–û–ì–ò–ö–ê (–•–û–†–û–®–û)
error: (err: any) => {
    console.error(`Step ${stepId} failed:`, err);
    
    // Retry logic: try up to 3 times
    const retryCount = (step as any).retryCount || 0;
    if (retryCount < 3) {
        console.log(`Retrying step ${stepId}, attempt ${retryCount + 1}/3`);
        (step as any).retryCount = retryCount + 1;
        step.status = 'processing'; // Keep as processing during retry
        setTimeout(() => {
            if (this._isRunning$.value && !this._isPaused$.value) {
                this.processStep(stepId);  // ‚úÖ –ü–û–í–¢–û–†–ò–¢–¨
            }
        }, 2000); // Wait 2 seconds before retry
    } else {
        // Max retries reached, skip and continue
        console.error(`Step ${stepId} failed after 3 retries, skipping...`);
        step.status = 'pending'; // Mark as failed
        (step as any).retryCount = 0; // Reset retry count
        
        // ‚úÖ –ü–†–û–î–û–õ–ñ–ò–¢–¨ –°–û –°–õ–ï–î–£–Æ–©–ï–ì–û –®–ê–ì–ê
        setTimeout(() => {
            if (this._isRunning$.value && !this._isPaused$.value) {
                const nextStep = this.steps[index + 1];
                if (nextStep) {
                    this.processStep(nextStep.id);
                } else {
                    this._isRunning$.next(false);
                }
            }
        }, 800);
    }
}
```

### 2. –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

| –ê—Å–ø–µ–∫—Ç | –°—Ç–∞—Ä–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ | –ù–æ–≤–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ |
|--------|------------------|-----------------|
| **–ü—Ä–∏ –æ—à–∏–±–∫–µ** | –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤–µ—Å—å batch | –ü–æ–≤—Ç–æ—Ä—è–µ—Ç 3 —Ä–∞–∑–∞ |
| **–ü–æ—Å–ª–µ 3 –Ω–µ—É–¥–∞—á** | –ü—Ä–æ—Ü–µ—Å—Å –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω | –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç —Ñ–∞–π–ª –∏ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç |
| **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** | –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ | –ü–æ–¥—Ä–æ–±–Ω–æ–µ —Å –Ω–æ–º–µ—Ä–æ–º –ø–æ–ø—ã—Ç–∫–∏ |
| **–ü–∞—É–∑–∞ –ø–µ—Ä–µ–¥ retry** | –ù–µ—Ç | 2 —Å–µ–∫—É–Ω–¥—ã |
| **–°–±—Ä–æ—Å —Å—á–µ—Ç—á–∏–∫–∞** | –ù–µ—Ç | –ü—Ä–∏ —É—Å–ø–µ—Ö–µ –∏ –ø—Ä–∏ reset |

### 3. –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

‚úÖ **–£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ —Å–±–æ—è–º**: –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–µ—Ç–µ–≤—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Ä–µ—à–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏  
‚úÖ **–ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã**: –î–∞–∂–µ –µ—Å–ª–∏ 1 –∏–∑ 10000 —Ñ–∞–π–ª–æ–≤ –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç—Å—è, –æ—Å—Ç–∞–ª—å–Ω—ã–µ 9999 –æ–±—Ä–∞–±–æ—Ç–∞—é—Ç—Å—è  
‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –≤–∏–¥–Ω–æ, –∫–∞–∫–∏–µ —Ñ–∞–π–ª—ã —É–ø–∞–ª–∏ –∏ —Å–∫–æ–ª—å–∫–æ –ø–æ–ø—ã—Ç–æ–∫ –±—ã–ª–æ  
‚úÖ **–ö–æ–Ω—Ç—Ä–æ–ª—å**: –ú–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å –≤ CSV —ç–∫—Å–ø–æ—Ä—Ç–µ, –∫–∞–∫–∏–µ —Ñ–∞–π–ª—ã –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞–ª–∏—Å—å (status = 'pending')  

---

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –í—Ä–µ–º–µ–Ω–Ω–∞—è –æ—à–∏–±–∫–∞ (—É—Å–ø–µ—Ö –Ω–∞ 2-–π –ø–æ–ø—ã—Ç–∫–µ)

```
1. –ü–æ–ø—ã—Ç–∫–∞ 1: ‚ùå –û—à–∏–±–∫–∞ (timeout)
   ‚Üí –ñ–¥–µ–º 2 —Å–µ–∫—É–Ω–¥—ã
2. –ü–æ–ø—ã—Ç–∫–∞ 2: ‚úÖ –£—Å–ø–µ—Ö
   ‚Üí –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —ç—Ç–∞–ø—É
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü–æ—Å—Ç–æ—è–Ω–Ω–∞—è –æ—à–∏–±–∫–∞ (3 –Ω–µ—É–¥–∞—á–∏)

```
1. –ü–æ–ø—ã—Ç–∫–∞ 1: ‚ùå –û—à–∏–±–∫–∞
   ‚Üí –ñ–¥–µ–º 2 —Å–µ–∫—É–Ω–¥—ã
2. –ü–æ–ø—ã—Ç–∫–∞ 2: ‚ùå –û—à–∏–±–∫–∞
   ‚Üí –ñ–¥–µ–º 2 —Å–µ–∫—É–Ω–¥—ã
3. –ü–æ–ø—ã—Ç–∫–∞ 3: ‚ùå –û—à–∏–±–∫–∞
   ‚Üí –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —ç—Ç–∞–ø, –∏–¥–µ–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: Batch –æ–±—Ä–∞–±–æ—Ç–∫–∞

```
–§–∞–π–ª 1: ‚úÖ –í—Å–µ —ç—Ç–∞–ø—ã —É—Å–ø–µ—à–Ω—ã
–§–∞–π–ª 2: ‚úÖ –í—Å–µ —ç—Ç–∞–ø—ã —É—Å–ø–µ—à–Ω—ã
–§–∞–π–ª 3: ‚ö†Ô∏è –≠—Ç–∞–ø 3 —É–ø–∞–ª –ø–æ—Å–ª–µ 3 –ø–æ–ø—ã—Ç–æ–∫ ‚Üí –ø—Ä–æ–ø—É—â–µ–Ω
        ‚úÖ –≠—Ç–∞–ø—ã 4, 5, 6 —É—Å–ø–µ—à–Ω—ã
–§–∞–π–ª 4: ‚úÖ –í—Å–µ —ç—Ç–∞–ø—ã —É—Å–ø–µ—à–Ω—ã
...
–§–∞–π–ª 10000: ‚úÖ –í—Å–µ —ç—Ç–∞–ø—ã —É—Å–ø–µ—à–Ω—ã

–†–µ–∑—É–ª—å—Ç–∞—Ç: 9999 —Ñ–∞–π–ª–æ–≤ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã, 1 —á–∞—Å—Ç–∏—á–Ω–æ
```

---

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (F12)

–¢–µ–ø–µ—Ä—å –≤—ã —É–≤–∏–¥–∏—Ç–µ –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏:

```
Step 3 failed: HttpErrorResponse {...}
Retrying step 3, attempt 1/3
Step 3 failed: HttpErrorResponse {...}
Retrying step 3, attempt 2/3
Step 3 failed: HttpErrorResponse {...}
Retrying step 3, attempt 3/3
Step 3 failed after 3 retries, skipping...
```

### –í —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–º CSV

–§–∞–π–ª—ã —Å –æ—à–∏–±–∫–∞–º–∏ –±—É–¥—É—Ç –∏–º–µ—Ç—å `status = pending` –¥–ª—è —É–ø–∞–≤—à–∏—Ö —ç—Ç–∞–ø–æ–≤:

```csv
ID,Name,Status,Score,ProcTime(ms),RecTime(ms)
1,Original,completed,,,
2,With Glasses,completed,0.8756,14,232
3,Inpainting,pending,,,  ‚Üê –£–ü–ê–õ
4,CNN,completed,0.8234,1082,1234
5,GAN,completed,0.8456,1098,1245
6,Hybrid,completed,0.8912,1105,1256
```

---

## –ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ –≤–∏–¥–∏—Ç–µ –∑–∞–≤–∏—Å–∞–Ω–∏–µ

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12)

–û—Ç–∫—Ä–æ–π—Ç–µ Developer Tools ‚Üí Console –∏ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ –æ—à–∏–±–∫–∏.

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ backend

```bash
tail -f /var/log/site-img-backend.log
```

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤

```bash
sudo systemctl status site-img-backend
sudo systemctl status site-img-frontend
```

### 4. –ï—Å–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –∑–∞–≤–∏—Å

–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É **Stop** (‚èπÔ∏è) –∏ –∑–∞—Ç–µ–º **Play** (‚ñ∂Ô∏è) —Å–Ω–æ–≤–∞.  
–°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Å —Ç–æ–≥–æ –º–µ—Å—Ç–∞, –≥–¥–µ –æ—Å—Ç–∞–Ω–æ–≤–∏–ª–∞—Å—å (–µ—Å–ª–∏ —Ñ–∞–π–ª—ã –µ—â–µ –≤ —Å–ø–∏—Å–∫–µ).

---

## –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ñ–∞–π–ª–∞—Ö

### –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:

1. **`/root/site-img/src/app/simulation.service.ts`**
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ retry –ª–æ–≥–∏–∫–∞
   - –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
   - –î–æ–±–∞–≤–ª–µ–Ω —Å—á–µ—Ç—á–∏–∫ –ø–æ–ø—ã—Ç–æ–∫

2. **`/root/site-img/backend/main.py`** (—Ä–∞–Ω–µ–µ)
   - –£–ª—É—á—à–µ–Ω cleanup —Ñ–∞–π–ª–æ–≤
   - –ù–∞—Å—Ç—Ä–æ–µ–Ω uvicorn –¥–ª—è batch processing

3. **`/root/site-img/src/app/dashboard/dashboard.component.ts`** (—Ä–∞–Ω–µ–µ)
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä

### Backup —Ñ–∞–π–ª—ã:

- `/root/site-img/src/app/simulation.service.ts.backup` - —Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è (–Ω–∞ —Å–ª—É—á–∞–π –æ—Ç–∫–∞—Ç–∞)

---

## –í—ã–≤–æ–¥

**–ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞!** üéâ

–¢–µ–ø–µ—Ä—å —Å–∏—Å—Ç–µ–º–∞:
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç –Ω–µ—É–¥–∞—á–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- ‚úÖ –ü—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- ‚úÖ –õ–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –ø—Ä–æ–±–ª–µ–º—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
- ‚úÖ –ù–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤–µ—Å—å batch –∏–∑-–∑–∞ –æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞

–í–∞—à –ø—Ä–æ–≥–æ–Ω –Ω–∞ 9999 —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π —Ç–µ–ø–µ—Ä—å –¥–æ–ª–∂–µ–Ω –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è —É—Å–ø–µ—à–Ω–æ, –¥–∞–∂–µ –µ—Å–ª–∏ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Ñ–∞–π–ª—ã —É–ø–∞–¥—É—Ç —Å –æ—à–∏–±–∫–∞–º–∏!
